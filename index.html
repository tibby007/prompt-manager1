<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .primary { color: #0F3460; }
        .primary-bg { background-color: #0F3460; }
        .secondary { color: #16A5A5; }
        .secondary-bg { background-color: #16A5A5; }
        .accent { color: #E6B325; }
        .accent-bg { background-color: #E6B325; }
        .bg-light { background-color: #F8F9FA; }
        .tag-pill {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            color: white;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="bg-light min-h-screen">
    <div id="app">
        <!-- App content will be dynamically inserted here -->
        <div class="flex justify-center items-center h-screen">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"></div>
        </div>
    </div>

    <script>
        // Main application code
        document.addEventListener('DOMContentLoaded', function() {
            // App state
            const state = {
                currentView: 'home',
                prompts: [],
                tags: [],
                searchQuery: '',
                editingPrompt: null,
                editingTag: null
            };

            // Initialize data from localStorage
            function initializeData() {
                const savedPrompts = localStorage.getItem('prompts');
                const savedTags = localStorage.getItem('tags');
                
                if (savedPrompts) {
                    state.prompts = JSON.parse(savedPrompts);
                } else {
                    // Sample prompts for first-time users
                    state.prompts = [
                        {
                            id: 'prompt_1',
                            content: 'Generate 10 blog post ideas about [TOPIC] that would be interesting for [TARGET AUDIENCE]. For each idea, include a catchy title and a brief description of what the post would cover.',
                            title: 'Blog Ideas Generator',
                            tags: ['content-creation', 'marketing'],
                            isFavorite: true,
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 'prompt_2',
                            content: 'Create a detailed step-by-step process for automating [SPECIFIC TASK] using Zapier. Include which apps to connect, what triggers to use, and any filters or conditions needed.',
                            title: '',
                            tags: ['automation', 'chatgpt-class'],
                            isFavorite: false,
                            createdAt: new Date().toISOString()
                        }
                    ];
                    savePrompts();
                }
                
                if (savedTags) {
                    state.tags = JSON.parse(savedTags);
                } else {
                    // Default tags
                    state.tags = [
                        { id: 'tag_1', name: 'Content Creation', color: '#3B82F6' },
                        { id: 'tag_2', name: 'Marketing', color: '#10B981' },
                        { id: 'tag_3', name: 'Automation', color: '#8B5CF6' },
                        { id: 'tag_4', name: 'ChatGPT Class', color: '#F59E0B' }
                    ];
                    saveTags();
                }
            }

            // Save prompts to localStorage
            function savePrompts() {
                localStorage.setItem('prompts', JSON.stringify(state.prompts));
            }

            // Save tags to localStorage
            function saveTags() {
                localStorage.setItem('tags', JSON.stringify(state.tags));
            }

            // Add a new prompt
            function addPrompt(prompt) {
                const newPrompt = {
                    id: 'prompt_' + Date.now(),
                    content: prompt.content,
                    title: prompt.title || '',
                    tags: prompt.tags || [],
                    isFavorite: false,
                    createdAt: new Date().toISOString()
                };
                
                state.prompts.unshift(newPrompt);
                savePrompts();
                return newPrompt;
            }

            // Update an existing prompt
            function updatePrompt(id, updates) {
                const index = state.prompts.findIndex(p => p.id === id);
                if (index !== -1) {
                    state.prompts[index] = { ...state.prompts[index], ...updates };
                    savePrompts();
                    return state.prompts[index];
                }
                return null;
            }

            // Delete a prompt
            function deletePrompt(id) {
                const index = state.prompts.findIndex(p => p.id === id);
                if (index !== -1) {
                    state.prompts.splice(index, 1);
                    savePrompts();
                    return true;
                }
                return false;
            }

            // Toggle favorite status
            function toggleFavorite(id) {
                const prompt = state.prompts.find(p => p.id === id);
                if (prompt) {
                    prompt.isFavorite = !prompt.isFavorite;
                    savePrompts();
                    return prompt.isFavorite;
                }
                return false;
            }

            // Add a new tag
            function addTag(tag) {
                const newTag = {
                    id: 'tag_' + Date.now(),
                    name: tag.name,
                    color: tag.color || getRandomColor()
                };
                
                state.tags.push(newTag);
                saveTags();
                return newTag;
            }

            // Delete a tag
            function deleteTag(id) {
                const index = state.tags.findIndex(t => t.id === id);
                if (index !== -1) {
                    // Remove tag from all prompts
                    state.prompts.forEach(prompt => {
                        const tagIndex = prompt.tags.indexOf(id);
                        if (tagIndex !== -1) {
                            prompt.tags.splice(tagIndex, 1);
                        }
                    });
                    
                    state.tags.splice(index, 1);
                    saveTags();
                    savePrompts();
                    return true;
                }
                return false;
            }

            // Search prompts
            function searchPrompts(query) {
                if (!query) return state.prompts;
                
                const lowerQuery = query.toLowerCase();
                return state.prompts.filter(prompt => 
                    prompt.content.toLowerCase().includes(lowerQuery) || 
                    prompt.title.toLowerCase().includes(lowerQuery) ||
                    prompt.tags.some(tagId => {
                        const tag = state.tags.find(t => t.id === tagId);
                        return tag && tag.name.toLowerCase().includes(lowerQuery);
                    })
                );
            }

            // Filter prompts by tag
            function filterPromptsByTag(tagId) {
                return state.prompts.filter(prompt => prompt.tags.includes(tagId));
            }

            // Get favorite prompts
            function getFavorites() {
                return state.prompts.filter(prompt => prompt.isFavorite);
            }

            // Generate a random color for tags
            function getRandomColor() {
                const colors = [
                    '#3B82F6', // Blue
                    '#10B981', // Green
                    '#8B5CF6', // Purple
                    '#F59E0B', // Amber
                    '#EF4444', // Red
                    '#EC4899', // Pink
                    '#06B6D4', // Cyan
                    '#0F3460', // Navy
                    '#16A5A5', // Teal
                    '#E6B325'  // Gold
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            // Render functions
            function renderApp() {
                const appContainer = document.getElementById('app');
                
                let content = '';
                
                // Header
                content += `
                    <header class="primary-bg text-white p-4 shadow-md">
                        <h1 class="text-xl font-bold">Prompt Manager</h1>
                    </header>
                `;
                
                // Main content
                content += `<main class="flex-1 p-4 pb-20 max-w-lg mx-auto">`;
                
                // Render current view
                switch (state.currentView) {
                    case 'home':
                        content += renderHomeView();
                        break;
                    case 'search':
                        content += renderSearchView();
                        break;
                    case 'tags':
                        content += renderTagsView();
                        break;
                    case 'favorites':
                        content += renderFavoritesView();
                        break;
                    case 'add':
                        content += renderAddPromptView();
                        break;
                    case 'edit':
                        content += renderEditPromptView();
                        break;
                    default:
                        content += renderHomeView();
                }
                
                content += `</main>`;
                
                // Floating action button (except on add/edit views)
                if (!['add', 'edit'].includes(state.currentView)) {
                    content += `
                        <div class="fixed right-6 bottom-20 z-10">
                            <button onclick="handleAddPrompt()" class="secondary-bg hover:bg-teal-600 text-white rounded-full p-4 shadow-lg flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                </svg>
                            </button>
                        </div>
                    `;
                }
                
                // Bottom navigation
                content += `
                    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 shadow-lg">
                        <div class="flex justify-around">
                            <a href="#" onclick="handleNavigation('home')" class="flex flex-col items-center py-2 px-4 ${state.currentView === 'home' ? 'text-secondary' : 'text-gray-500'}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                </svg>
                                <span class="text-xs mt-1">Home</span>
                            </a>
                            <a href="#" onclick="handleNavigation('search')" class="flex flex-col items-center py-2 px-4 ${state.currentView === 'search' ? 'text-secondary' : 'text-gray-500'}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                <span class="text-xs mt-1">Search</span>
                            </a>
                            <a href="#" onclick="handleNavigation('tags')" class="flex flex-col items-center py-2 px-4 ${state.currentView === 'tags' ? 'text-secondary' : 'text-gray-500'}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                                </svg>
                                <span class="text-xs mt-1">Tags</span>
                            </a>
                            <a href="#" onclick="handleNavigation('favorites')" class="flex flex-col items-center py-2 px-4 ${state.currentView === 'favorites' ? 'text-secondary' : 'text-gray-500'}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                                </svg>
                                <span class="text-xs mt-1">Favorites</span>
                            </a>
                        </div>
                    </nav>
                `;
                
                appContainer.innerHTML = content;
            }

            function renderHomeView() {
                let content = `
                    <h2 class="text-2xl font-bold mb-4">My Prompts</h2>
                `;
                
                if (state.prompts.length === 0) {
                    content += `
                        <div class="bg-white rounded-lg shadow-md p-6 text-center">
                            <p class="text-gray-600 mb-4">You don't have any prompts yet.</p>
                            <button onclick="handleAddPrompt()" class="px-4 py-2 bg-teal-500 text-white rounded-md hover:bg-teal-600">
                                Add Your First Prompt
                            </button>
                        </div>
                    `;
                } else {
                    content += `<div class="space-y-4">`;
                    
                    state.prompts.forEach(prompt => {
                        content += renderPromptCard(prompt);
                    });
                    
                    content += `</div>`;
                }
                
                return content;
            }

            function renderSearchView() {
                let content = `
                    <h2 class="text-2xl font-bold mb-4">Search</h2>
                    
                    <div class="mb-6 relative">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="Search prompts..." 
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary"
                            value="${state.searchQuery}"
                            oninput="handleSearch(this.value)"
                        >
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                        ${state.searchQuery ? `
                            <button 
                                class="absolute inset-y-0 right-0 pr-3 flex items-center"
                                onclick="handleClearSearch()"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        ` : ''}
                    </div>
                `;
                
                if (state.searchQuery) {
                    const results = searchPrompts(state.searchQuery);
                    
                    if (results.length === 0) {
                        content += `
                            <p class="text-gray-600 text-center py-4">No prompts found matching "${state.searchQuery}"</p>
                        `;
                    } else {
                        content += `
                            <p class="text-sm text-gray-600 mb-3">${results.length} result${results.length !== 1 ? 's' : ''} for "${state.searchQuery}"</p>
                            <div class="space-y-4">
                        `;
                        
                        results.forEach(prompt => {
                            content += renderPromptCard(prompt);
                        });
                        
                        content += `</div>`;
                    }
                } else {
                    content += `
                        <div class="bg-white rounded-lg shadow-md p-6 text-center">
                            <p class="text-gray-600">Enter a search term to find prompts</p>
                        </div>
                    `;
                }
                
                return content;
            }

            function renderTagsView() {
                let content = `
                    <h2 class="text-2xl font-bold mb-4">Manage Tags</h2>
                    
                    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                        <h3 class="text-lg font-medium mb-3">Create New Tag</h3>
                        
                        <div class="space-y-3">
                            <div>
                                <label for="tagName" class="block text-sm font-medium text-gray-700 mb-1">
                                    Tag Name
                                </label>
                                <input
                                    type="text"
                                    id="tagName"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-secondary focus:border-secondary"
                                    placeholder="Enter tag name"
                                />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Tag Color
                                </label>
                                <div class="flex flex-wrap gap-2" id="colorPicker">
                                    <button onclick="handleSelectColor('#3B82F6')" class="w-8 h-8 rounded-full" style="background-color: #3B82F6;"></button>
                                    <button onclick="handleSelectColor('#10B981')" class="w-8 h-8 rounded-full" style="background-color: #10B981;"></button>
                                    <button onclick="handleSelectColor('#8B5CF6')" class="w-8 h-8 rounded-full" style="background-color: #8B5CF6;"></button>
                                    <button onclick="handleSelectColor('#F59E0B')" class="w-8 h-8 rounded-full" style="background-color: #F59E0B;"></button>
                                    <button onclick="handleSelectColor('#EF4444')" class="w-8 h-8 rounded-full" style="background-color: #EF4444;"></button>
                                    <button onclick="handleSelectColor('#EC4899')" class="w-8 h-8 rounded-full" style="background-color: #EC4899;"></button>
                                    <button onclick="handleSelectColor('#0F3460')" class="w-8 h-8 rounded-full" style="background-color: #0F3460;"></button>
                                    <button onclick="handleSelectColor('#16A5A5')" class="w-8 h-8 rounded-full" style="background-color: #16A5A5;"></button>
                                    <button onclick="handleSelectColor('#E6B325')" class="w-8 h-8 rounded-full" style="background-color: #E6B325;"></button>
                                </div>
                                <input type="hidden" id="selectedColor" value="#3B82F6">
                            </div>
                            
                            <button onclick="handleCreateTag()" class="w-full py-2 rounded-md bg-teal-500 text-white hover:bg-teal-600">
                                Create Tag
                            </button>
                        </div>
                    </div>
                `;
                
                if (state.tags.length === 0) {
                    content += `
                        <div class="bg-white rounded-lg shadow-md p-6 text-center">
                            <p class="text-gray-600">You don't have any tags yet</p>
                        </div>
                    `;
                } else {
                    content += `
                        <div class="bg-white rounded-lg shadow-md p-4">
                            <h3 class="text-lg font-medium mb-3">Your Tags</h3>
                            
                            <ul class="divide-y divide-gray-200">
                    `;
                    
                    state.tags.forEach(tag => {
                        content += `
                            <li class="py-3 flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-6 h-6 rounded-full mr-3" style="background-color: ${tag.color};"></div>
                                    <span>${tag.name}</span>
                                </div>
                                <button onclick="handleDeleteTag('${tag.id}')" class="text-gray-400 hover:text-red-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </li>
                        `;
                    });
                    
                    content += `
                            </ul>
                        </div>
                    `;
                }
                
                return content;
            }

            function renderFavoritesView() {
                let content = `
                    <h2 class="text-2xl font-bold mb-4">Favorites</h2>
                `;
                
                const favorites = getFavorites();
                
                if (favorites.length === 0) {
                    content += `
                        <div class="bg-white rounded-lg shadow-md p-6 text-center">
                            <p class="text-gray-600 mb-4">You don't have any favorite prompts yet.</p>
                            <p class="text-gray-500">Star prompts to add them to your favorites.</p>
                        </div>
                    `;
                } else {
                    content += `<div class="space-y-4">`;
                    
                    favorites.forEach(prompt => {
                        content += renderPromptCard(prompt);
                    });
                    
                    content += `</div>`;
                }
                
                return content;
            }

            function renderAddPromptView() {
                return `
                    <h2 class="text-2xl font-bold mb-4">Add New Prompt</h2>
                    
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <form id="promptForm" onsubmit="handleSavePrompt(event)">
                            <!-- Prompt content (most prominent) -->
                            <div class="mb-4">
                                <label for="content" class="block text-sm font-medium text-gray-700 mb-1">
                                    Prompt Content
                                </label>
                                <textarea
                                    id="content"
                                    rows="6"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-secondary focus:border-secondary"
                                    placeholder="Paste or type your prompt here..."
                                    required
                                ></textarea>
                            </div>
                            
                            <!-- Optional title -->
                            <div class="mb-4">
                                <label for="title" class="block text-sm font-medium text-gray-700 mb-1">
                                    Title (Optional)
                                </label>
                                <input
                                    type="text"
                                    id="title"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-secondary focus:border-secondary"
                                    placeholder="Add a title to help identify this prompt"
                                />
                            </div>
                            
                            <!-- Tags -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Tags
                                </label>
                                <div class="flex flex-wrap gap-2 mb-2" id="tagSelector">
                                    ${renderTagSelector()}
                                </div>
                            </div>
                            
                            <!-- Buttons -->
                            <div class="flex justify-end space-x-3">
                                <button
                                    type="button"
                                    onclick="handleNavigation('home')"
                                    class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white secondary-bg hover:bg-teal-600"
                                >
                                    Save Prompt
                                </button>
                            </div>
                        </form>
                    </div>
                `;
            }

            function renderEditPromptView() {
                const prompt = state.editingPrompt;
                if (!prompt) return renderHomeView();
                
                return `
                    <h2 class="text-2xl font-bold mb-4">Edit Prompt</h2>
                    
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <form id="editPromptForm" onsubmit="handleUpdatePrompt(event)">
                            <input type="hidden" id="promptId" value="${prompt.id}">
                            
                            <!-- Prompt content (most prominent) -->
                            <div class="mb-4">
                                <label for="editContent" class="block text-sm font-medium text-gray-700 mb-1">
                                    Prompt Content
                                </label>
                                <textarea
                                    id="editContent"
                                    rows="6"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-secondary focus:border-secondary"
                                    placeholder="Paste or type your prompt here..."
                                    required
                                >${prompt.content}</textarea>
                            </div>
                            
                            <!-- Optional title -->
                            <div class="mb-4">
                                <label for="editTitle" class="block text-sm font-medium text-gray-700 mb-1">
                                    Title (Optional)
                                </label>
                                <input
                                    type="text"
                                    id="editTitle"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-secondary focus:border-secondary"
                                    placeholder="Add a title to help identify this prompt"
                                    value="${prompt.title}"
                                />
                            </div>
                            
                            <!-- Tags -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Tags
                                </label>
                                <div class="flex flex-wrap gap-2 mb-2" id="editTagSelector">
                                    ${renderTagSelector(prompt.tags)}
                                </div>
                            </div>
                            
                            <!-- Buttons -->
                            <div class="flex justify-between">
                                <button
                                    type="button"
                                    onclick="handleDeletePromptConfirm('${prompt.id}')"
                                    class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-500 hover:bg-red-600"
                                >
                                    Delete
                                </button>
                                
                                <div class="flex space-x-3">
                                    <button
                                        type="button"
                                        onclick="handleNavigation('home')"
                                        class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white secondary-bg hover:bg-teal-600"
                                    >
                                        Update Prompt
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                `;
            }

            function renderPromptCard(prompt) {
                const promptTags = prompt.tags.map(tagId => {
                    const tag = state.tags.find(t => t.id === tagId);
                    return tag ? `
                        <span class="tag-pill" style="background-color: ${tag.color};">
                            ${tag.name}
                        </span>
                    ` : '';
                }).join('');
                
                return `
                    <div class="bg-white rounded-lg shadow-md p-4">
                        ${prompt.title ? `<h3 class="text-gray-600 text-sm mb-2">${prompt.title}</h3>` : ''}
                        <div class="text-gray-900 font-medium mb-3">${prompt.content}</div>
                        <div class="flex flex-wrap items-center justify-between mt-2">
                            <div class="flex flex-wrap gap-2 mb-2">
                                ${promptTags}
                            </div>
                            <div class="flex items-center justify-between w-full mt-2">
                                <span class="text-xs text-gray-500">${formatDate(prompt.createdAt)}</span>
                                <div class="flex space-x-2">
                                    <button onclick="handleToggleFavorite('${prompt.id}')" class="${prompt.isFavorite ? 'text-accent' : 'text-gray-400 hover:text-accent'}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="${prompt.isFavorite ? 'currentColor' : 'none'}" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                                        </svg>
                                    </button>
                                    <button onclick="handleEditPrompt('${prompt.id}')" class="text-gray-400 hover:text-primary">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                        </svg>
                                    </button>
                                    <button onclick="handleCopyPrompt('${prompt.id}')" class="text-gray-400 hover:text-primary">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderTagSelector(selectedTags = []) {
                let content = '';
                
                state.tags.forEach(tag => {
                    const isSelected = selectedTags.includes(tag.id);
                    content += `
                        <button 
                            type="button" 
                            onclick="handleToggleTag('${tag.id}')" 
                            class="px-3 py-1 rounded-full text-xs font-medium ${isSelected ? 'text-white' : 'bg-gray-200 text-gray-700'}"
                            style="${isSelected ? `background-color: ${tag.color};` : ''}"
                            data-tag-id="${tag.id}"
                            data-selected="${isSelected}"
                        >
                            ${tag.name}
                        </button>
                    `;
                });
                
                return content;
            }

            // Helper functions
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            }

            // Event handlers
            window.handleNavigation = function(view) {
                state.currentView = view;
                renderApp();
            };

            window.handleSearch = function(query) {
                state.searchQuery = query;
                renderApp();
            };

            window.handleClearSearch = function() {
                state.searchQuery = '';
                renderApp();
            };

            window.handleAddPrompt = function() {
                state.currentView = 'add';
                renderApp();
            };

            window.handleSavePrompt = function(event) {
                event.preventDefault();
                
                const content = document.getElementById('content').value;
                const title = document.getElementById('title').value;
                
                // Get selected tags
                const selectedTags = [];
                const tagButtons = document.querySelectorAll('#tagSelector button[data-selected="true"]');
                tagButtons.forEach(button => {
                    selectedTags.push(button.getAttribute('data-tag-id'));
                });
                
                addPrompt({
                    content,
                    title,
                    tags: selectedTags
                });
                
                state.currentView = 'home';
                renderApp();
            };

            window.handleEditPrompt = function(id) {
                const prompt = state.prompts.find(p => p.id === id);
                if (prompt) {
                    state.editingPrompt = prompt;
                    state.currentView = 'edit';
                    renderApp();
                }
            };

            window.handleUpdatePrompt = function(event) {
                event.preventDefault();
                
                const id = document.getElementById('promptId').value;
                const content = document.getElementById('editContent').value;
                const title = document.getElementById('editTitle').value;
                
                // Get selected tags
                const selectedTags = [];
                const tagButtons = document.querySelectorAll('#editTagSelector button[data-selected="true"]');
                tagButtons.forEach(button => {
                    selectedTags.push(button.getAttribute('data-tag-id'));
                });
                
                updatePrompt(id, {
                    content,
                    title,
                    tags: selectedTags
                });
                
                state.editingPrompt = null;
                state.currentView = 'home';
                renderApp();
            };

            window.handleDeletePromptConfirm = function(id) {
                if (confirm('Are you sure you want to delete this prompt?')) {
                    deletePrompt(id);
                    state.editingPrompt = null;
                    state.currentView = 'home';
                    renderApp();
                }
            };

            window.handleToggleFavorite = function(id) {
                toggleFavorite(id);
                renderApp();
            };

            window.handleCopyPrompt = function(id) {
                const prompt = state.prompts.find(p => p.id === id);
                if (prompt) {
                    navigator.clipboard.writeText(prompt.content)
                        .then(() => {
                            alert('Prompt copied to clipboard!');
                        })
                        .catch(err => {
                            console.error('Could not copy text: ', err);
                            alert('Failed to copy prompt. Please try again.');
                        });
                }
            };

            window.handleCreateTag = function() {
                const name = document.getElementById('tagName').value;
                const color = document.getElementById('selectedColor').value;
                
                if (!name) {
                    alert('Please enter a tag name');
                    return;
                }
                
                addTag({ name, color });
                document.getElementById('tagName').value = '';
                renderApp();
            };

            window.handleDeleteTag = function(id) {
                if (confirm('Are you sure you want to delete this tag? It will be removed from all prompts.')) {
                    deleteTag(id);
                    renderApp();
                }
            };

            window.handleSelectColor = function(color) {
                document.getElementById('selectedColor').value = color;
                
                // Update visual selection
                const colorButtons = document.querySelectorAll('#colorPicker button');
                colorButtons.forEach(button => {
                    if (button.style.backgroundColor === color) {
                        button.classList.add('ring-2', 'ring-gray-400', 'ring-offset-1');
                    } else {
                        button.classList.remove('ring-2', 'ring-gray-400', 'ring-offset-1');
                    }
                });
            };

            window.handleToggleTag = function(tagId) {
                const button = document.querySelector(`button[data-tag-id="${tagId}"]`);
                const isSelected = button.getAttribute('data-selected') === 'true';
                const tag = state.tags.find(t => t.id === tagId);
                
                if (isSelected) {
                    button.setAttribute('data-selected', 'false');
                    button.classList.remove('text-white');
                    button.classList.add('bg-gray-200', 'text-gray-700');
                    button.style.backgroundColor = '';
                } else {
                    button.setAttribute('data-selected', 'true');
                    button.classList.add('text-white');
                    button.classList.remove('bg-gray-200', 'text-gray-700');
                    button.style.backgroundColor = tag.color;
                }
            };

            // Initialize the app
            initializeData();
            renderApp();
            
            // Set initial color selection
            setTimeout(() => {
                const firstColorButton = document.querySelector('#colorPicker button');
                if (firstColorButton) {
                    firstColorButton.classList.add('ring-2', 'ring-gray-400', 'ring-offset-1');
                }
            }, 100);
        });
    </script>
</body>
</html>
